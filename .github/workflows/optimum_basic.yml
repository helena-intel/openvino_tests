name: optimum_basic

on:
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.run_id }}
  cancel-in-progress: true

jobs:
  build_optimum:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-20.04,]
        python: [3.8,]
        # torch: ['torch==1.9.*', 'torch==1.13.*']
        torch: ['torch==1.13.*']
        transformers: ['transformers==4.24.*', 'git+https://github.com/huggingface/transformers.git']
        optimum: ['optimum==1.5.*', 'optimum==1.4.*']
        optimum-intel: ['optimum-intel', 'git+https://github.com/huggingface/optimum-intel.git']
        openvino: ['openvino', 'openvino --pre']
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
    - name: Set up Python
      uses: actions/setup-python@v1
      with:
        python-version: ${{ matrix.python }}

    - name: Install requirements
      run: |
        python -m pip install ${{ matrix.optimum }} ${{ matrix.torch }} ${{ matrix.transformers }} ${{ matrix.optimum-intel }}
        python -m pip install ${{ matrix.openvino }}
      working-directory: code/nlp

    - name: Run load_model script
      working-directory: code/nlp
      run: 
        python load_models.py

